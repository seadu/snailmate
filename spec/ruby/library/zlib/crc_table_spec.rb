require_relative '../../spec_helper'
require "zlib"

describe "Zlib.crc_table" do
  # This spec fails when zlib.h and libz.so are not from the same version.
  # In older zlib (< 1.2.7 it seems), get_crc_table() is stored as u64[],
  # but in newer zlib, get_crc_table() is stored as u32[].
  # Technically, there is ABI breakage between those zlib versions,
  # but get_crc_table() is an "undocumented function" according to zlib.h.
  guard -> { ENV["RUBY_SPEC_TEST_ZLIB_CRC_TABLE"] != "false" } do
    it "returns the same value as zlib's get_crc_table()" do
      Zlib.crc_table.should == [
        0, 1996959894, 3993919788, 2567524794,
        124634137, 1886057615, 3915621685, 2657392035,
        249268274, 2044508324, 3772115230, 2547177864,
        162941995, 2125561021, 3887607047, 2428444049,
        498536548, 1789927666, 4089016648, 2227061214,
        450548861, 1843258603, 4107580753, 2211677639,
        325883990, 1684777152, 4251122042, 2321926636,
        335633487, 1661365465, 4195302755, 2366115317,
        997073096, 1281953886, 3579855332, 2724688242,
        1006888145, 1258607687, 3524101629, 2768942443,
        901097722, 1119000684, 3686517206, 2898065728,
        853044451, 1172266101, 3705015759, 2882616665,
        651767980, 1373503546, 3369554304, 3218104598,
        565507253, 1454621731, 3485111705, 3099436303,
        671266974, 1594198024, 3322730930, 2970347812,
        795835527, 1483230225, 3244367275, 3060149565,
        1994146192, 31158534, 2563907772, 4023717930,
        1907459465, 112637215, 2680153253, 3904427059,
        2013776290, 251722036, 2517215374, 3775830040,
        2137656763, 141376813, 2439277719, 3865271297,
        1802195444, 476864866, 2238001368, 4066508878,
        1812370925, 453092731, 2181625025, 4111451223,
        1706088902, 314042704, 2344532202, 4240017532,
        1658658271, 366619977, 2362670323, 4224994405,
        1303535960, 984961486, 2747007092, 3569037538,
        1256170817, 1037604311, 2765210733, 3554079995,
        1131014506, 879679996, 2909243462, 3663771856,
        1141124467, 855842277, 2852801631, 370864